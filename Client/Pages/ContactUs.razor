@page "/ContactUs"
@using ReichertsMeatDistributing.Shared;
@using SendGrid;
@using SendGrid.Helpers.Mail;
@using System.Text.Json;
@using System.Text;
@inject HttpClient HttpClient



<div class="bkg">
    <div class="container">
        <div class="row justify-content-center pt-5">
            <div class="col-md-6">
                <div class="card border-0">
                    <div class="card-body">
                                <h2 class="card-title text-center">Contact Us</h2>

                                <p class="text-center">We're here to help! If you have any questions or inquiries, please fill out the form below and we'll get back to you as soon as possible or contact us by phone <br />(360) - 330 - 1653.</p>

                                <form>
                                    <div class="form-group">
                                        <label for="name">Name:</label>
                                        <input id="name" class="form-control" @bind="Contact.Name" />
                                    </div>

                                    <div class="form-group">
                                        <label for="email">Email:</label>
                                        <input id="email" class="form-control" @bind="Contact.Email" />
                                    </div>

                                    <div class="form-group">
                                        <label for="message">Message:</label>
                                        <textarea id="message" class="form-control" rows="5" @bind="Contact.Message"></textarea>
                                    </div>

                                    <input type="button" class="btn btn-primary" @onclick="SubmitForm" value="Submit" />
                                </form>

                                @if (ShowConfirmation)
                                {
                                    <div class="alert alert-success mt-3">
                                        Thank you for contacting us! We will get back to you shortly.
                                    </div>
                                }
                    </div>
                </div>
            </div>
            <div class="col-sm-1">
                <div class="vertical-line"></div>
            </div>
            <div class="col-md-4">
                <div class="card border-0">
                    <div class="card-body">
                        <h3 class="card-title text-center">Hours of Operation</h3>

                        <table class="table text-left">
                            <thead>
                                <tr>
                                    <th>Day</th>
                                    <th>Hours</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Monday</td>
                                    <td>7:00 AM - 3:00 PM</td>
                                </tr>
                                <tr>
                                    <td>Tuesday</td>
                                    <td>7:00 AM - 3:00 PM</td>
                                </tr>
                                <tr>
                                    <td>Wednesday</td>
                                    <td>7:00 AM - 3:00 PM</td>
                                </tr>
                                <tr>
                                    <td>Thursday</td>
                                    <td>7:00 AM - 3:00 PM</td>
                                </tr>
                                <tr>
                                    <td>Friday</td>
                                    <td>7:00 AM - 3:00 PM</td>
                                </tr>
                                <tr>
                                    <td>Saturday</td>
                                    <td>Closed</td>
                                </tr>
                                <tr>
                                    <td>Sunday</td>
                                    <td>Closed</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@code {
    private ContactModel Contact { get; set; } = new ContactModel();
    private bool ShowConfirmation { get; set; } = false;
    private string SendGridApiKey { get; } = "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";
    private bool Confirmation { get; set; } = false;

    private async Task SubmitForm()
    {
        if (string.IsNullOrWhiteSpace(Contact.Name) || string.IsNullOrWhiteSpace(Contact.Email) || string.IsNullOrWhiteSpace(Contact.Message))
        {
            // Display an error message or handle invalid input
            return;
        }

        // Send email
        await SendEmailAsync(Contact);

        // Show confirmation message
        Contact = new ContactModel(); // Clear the form
    }


    private async Task SendEmailAsync(ContactModel contact)
    {
        try
        {
            var response = await HttpClient.PostAsJsonAsync("api/SendGridProxy", contact);
            response.EnsureSuccessStatusCode();
            if (response.IsSuccessStatusCode)
            {
                Confirmation = true;
            }
        }
        catch (Exception ex)
        {
            // Error handling
        }
    }






}


